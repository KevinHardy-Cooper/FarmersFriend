<!DOCTYPE html>
<html>
	<head>

		<!-- Character encoding -->
		<meta charset = "UTF-8"/>

		<!-- Assisting with scaling from desktop to mobile, inspired by https://www.w3schools.com/css/css_rwd_viewport.asp -->
		<meta name = "viewport" content = "width = device-width, initial-scale = 1"/>
		
		<!-- Page author -->
		<meta name = "author" content = "Kevin Hardy-Cooper"/>

		<!-- Page description -->
		<meta name = "description" content = "Search for farms"/>

		<!-- Title of the page -->
		<title>Farmer's Friend</title>

		<!-- Importing external stylesheet -->
		<link href="stylesheets/global.css" type="text/css" rel="stylesheet"/>
		<link href="stylesheets/search.css" type="text/css" rel="stylesheet"/>
	</head>
	<body>
		<header>

			<!-- Navbar -->
			<nav>
				<ul>
					<li class = "justify-left">
						<a href = "index.html">
							Farmer's Friend
						</a>
					</li>
					<li class = "justify-right">
						<a href = "sign_in.html">
							Sign In
						</a>
					</li>
					<li class = "justify-right">
						<a href = "registration.html">
							Sign Up
						</a>
					</li>
					<li class = "justify-right">
						<a href = "submission.html">
							Register Farm
						</a>
					</li>
					<li class = "justify-right">

					<!-- When on this page, show tab as coloured -->
						<a class = "active" href = "#">
							Search
						</a>
					</li>
				</ul>
			</nav>
		</header>

		<!-- Skipping some lines for formatting -->
		<br>
		<br>
		<br>

		<main>
			<article>

				<!-- Headline for the page -->
				<h1 class = "horiz-div">
					Find an amazing farm.
				</h1>
				
				<!-- Skipping some lines for formatting -->
				<br>
				<br>
				<br>

				<!-- Search Form begins... -->
				<div class = "middle-div large-text">
					<form method = "get" action = "results_sample.html">

						<!-- Name field -->
						<label>
							Search
							<input class = "large-field" type = "search" placeholder = "Names" name = "name"/>
						</label>
						<label>
							or
						<!-- Ratings field -->
							<select class = "large-field thick-border" name = "rating">
								<option value = "0"> 
									Ratings 
								</option>
								<option value = "1"> 
									&#9734; 
								</option>
								<option value = "2"> 
									&#9734; &#9734; 
								</option>
								<option value = "3"> 
									&#9734; &#9734; &#9734; 
								</option>
								<option value = "4"> 
									&#9734; &#9734; &#9734; &#9734;
								</option>
								<option value = "5"> 
									&#9734; &#9734; &#9734; &#9734; &#9734; 
								</option>
							</select>
						</label>	
						
						<!-- Submit button field -->
						<button type = "submit" class = "large-field">
							<picture>
								<source srcset = "assets/img/magnifying-glass.png">
								<img alt = "Search" class = "mag-glass" src = "assets/img/magnifying-glass.png"/>
							</picture>
						</button>
					</form>
					<br>
					Don't know what your looking for?
					<button type = "button" onclick = "getLocation()" class = "large-field">
						Find Farms Near Me
					</button>
					
					<!-- will contain the status regarding the geolocation services -->
					<div id = "geoResults"></div>

					<!-- will contain the spinner, if we need it -->
					<div id = "spinner" class = "spinner"></div>

				</div>
			</article>

			<picture>
				<img class = "animal" alt = "Image of a chicken" src = "filler"/>
			</picture>

		</main>
		
		<!-- Footer -->
		<footer>
			<p> 
				Made with 
				<picture>
					<source srcset = "assets/img/corn.png">
					<img alt = "Corn" class = "footer-emoji" src = "assets/img/corn.png"> 
				</picture>
				&nbsp;by Kevin Hardy-Cooper &copy; 2018
			</p>
		</footer>
	</body>
</html>

<script>

	// Start the location delegate
	function getLocation() {

		// if HTML5 geolocation exists
  		if (navigator.geolocation) {

  			// Need to show loader
			document.getElementById("spinner").style = "display:block";

  			// Get the current position of the user, if successful call showPosition, if not successful showError
			navigator.geolocation.getCurrentPosition(showPosition, showError);
  		
		} else { // If HTML5 geolocation does not exist
			document.getElementById("geoResults").innerHTML = "Geolocation is not supported by this browser.";
		}
	}

	// Show the user's position
	function showPosition(position) {

		// Grab user's location and return it
		findFarmsNearMe(position.coords.latitude, position.coords.longitude);
	}

	// Show error to user
	function showError(error) {

		// Need to hide loader
		document.getElementById("spinner").style = "display:none";

		switch(error.code) {
			case error.PERMISSION_DENIED:
				document.getElementById("geoResults").innerHTML  = "User denied the request for Geolocation."
				break;
			case error.POSITION_UNAVAILABLE:
				document.getElementById("geoResults").innerHTML  = "Location information is unavailable."
				break;
			case error.TIMEOUT:
				document.getElementById("geoResults").innerHTML  = "The request to get user location timed out."
				break;
			case error.UNKNOWN_ERROR:
				document.getElementById("geoResults").innerHTML  = "An unknown error occurred."
				break;
		}
	}

	function findFarmsNearMe(lat, lon) {

		// Reset geo status
		document.getElementById("geoResults").innerHTML = "";

		// We are now going to create a form, add fields for lat and lon, and then submit the form to the back end
		var form = createFormElement();
		
		// creating and populating the latitude and longitude form fields
		var latitude = createFormNumberElement("latitude", lat);
		var longitude = createFormNumberElement("longitude", lon);	

		// appending the form fields to the form
		form.appendChild(latitude);
		form.appendChild(longitude);

		// appending the form to the body of the DOM
		document.getElementsByTagName('body')[0].appendChild(form);

		// Need to hide loader
		document.getElementById("spinner").style = "display:none";

		// submitting the form
		document.forms['coordsForm'].submit();	

		// once we have back end setup, we can then query all records and use the haversine function in order to find all farms within 50km (?) from the user
		// then we'll return direct the user to the results page and populate the table with this list
	}

	// Create s a form element
	function createFormElement() {
		var form = document.createElement("form");
		form.setAttribute("name", "coordsForm");
		form.setAttribute("method", "get");
		form.setAttribute("action", "results_sample.html");

		// do not display form for when we add it to the DOM
		form.setAttribute("style", "display:none");
		return form;
	}

	// Creates a form number element
	function createFormNumberElement(name, value) {
		var number = document.createElement("input");
		number.setAttribute("type", "number");
		number.setAttribute("name", name);
		number.setAttribute("value", value);
		return number;
	}
</script>
